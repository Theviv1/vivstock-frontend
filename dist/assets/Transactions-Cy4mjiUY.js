import{r as h,o as b,y as p,l as u,c as i,k as v,b as t,F as y,q as w,x as g,a as c,t as r,n as x,H as f}from"./index-DE0sq3M8.js";import{_ as k}from"./AdminNav-dYmzuoiQ.js";const C={class:"min-h-screen bg-[#111111] text-white"},T={class:"lg:pl-64 p-6"},$={class:"space-y-4"},E={class:"flex justify-between items-start mb-4"},F={class:"font-semibold"},N={class:"text-sm text-gray-400"},A={class:"text-sm text-gray-400"},S={class:"text-right"},V={class:"font-semibold"},j={key:0,class:"flex gap-2"},q=["onClick"],B=["onClick"],D={key:0,class:"text-center text-gray-400"},z={__name:"Transactions",setup(L){const l=h([]);b(async()=>{await _()});const _=async()=>{try{const{data:o,error:s}=await p.from("transactions").select(`
        *,
        profiles:user_id (username, email)
      `).order("created_at",{ascending:!1});if(s)throw s;l.value=o||[]}catch(o){console.error("Error fetching transactions:",o),u.error("Failed to load transactions")}},m=async(o,s)=>{try{const e=l.value.find(a=>a.id===o),{error:n}=await p.from("transactions").update({status:s,updated_at:new Date().toISOString()}).eq("id",o);if(n)throw n;if(s==="approved"){const a=e.type==="deposit"?e.amount:-e.amount,{error:d}=await p.from("profiles").update({balance:p.raw(`balance + ${a}`)}).eq("id",e.user_id);if(d)throw d}u.success(`Transaction ${s}`),await _()}catch(e){console.error("Error processing transaction:",e),u.error("Failed to process transaction")}};return(o,s)=>(c(),i("div",C,[v(k),t("div",T,[s[2]||(s[2]=t("h1",{class:"text-2xl font-bold mb-6"},"Transaction Management",-1)),t("div",$,[(c(!0),i(y,null,w(l.value,e=>{var n,a;return c(),i("div",{key:e.id,class:"bg-[#1A1A1A] rounded-lg p-4"},[t("div",E,[t("div",null,[t("h3",F,r((n=e.profiles)==null?void 0:n.username),1),t("p",N,r((a=e.profiles)==null?void 0:a.email),1),t("p",A,r(new Date(e.created_at).toLocaleString()),1)]),t("div",S,[t("p",V,"$"+r(e.amount.toFixed(2)),1),t("p",{class:x(["text-sm",e.type==="deposit"?"text-green-500":"text-red-500"])},r(e.type.toUpperCase()),3),t("p",{class:x(["text-sm",e.status==="pending"?"text-yellow-500":e.status==="approved"?"text-green-500":"text-red-500"])},r(e.status.toUpperCase()),3)])]),e.status==="pending"?(c(),i("div",j,[t("button",{onClick:d=>m(e.id,"approved"),class:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700"},s[0]||(s[0]=[t("i",{class:"bi-check"},null,-1),f(" Approve ")]),8,q),t("button",{onClick:d=>m(e.id,"rejected"),class:"flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700"},s[1]||(s[1]=[t("i",{class:"bi-x"},null,-1),f(" Reject ")]),8,B)])):g("",!0)])}),128)),l.value.length===0?(c(),i("div",D," No transactions found ")):g("",!0)])])]))}};export{z as default};
